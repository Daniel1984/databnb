#!/usr/bin/env node

const http = require('http');
const app = require('../app');
const pricePrediction = require('../routes/pricePrediction/pricePrediction');
const scrapeNearbyListings = require('../routes/airbnbPropertyHandler/helpers/scrapeNearbyListings');

const port = process.env.PORT || 3000;
app.set('port', port);

const server = http.createServer(app);
const socket = require('socket.io')(server);

socket.on('connection', (io) => {
  io.on('getListings', (params) => {
    pricePrediction({ ...params, socket: io });
  });

  io.on('getNearbyListings', (props) => {
    scrapeNearbyListings({ ...props, socket: io });
  });
});

server.listen(port, () => {
  console.log(`Server listening at ${port}`)
});
